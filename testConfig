configuration TestConfig
{
    Import-DscResource -ModuleName PSDesiredStateConfiguration
    
    $svcTeamCityAgent = Get-AutomationPSCredential -Name 'svcTeamCityAgent'
    
    Node WebServer
    {
        WindowsFeature IIS
        {
            Ensure               = 'Present'
            Name                 = 'Web-Server'
            IncludeAllSubFeature = $true

        }
    }

    Node NotWebServer
    {
        WindowsFeature IIS
        {
            Ensure               = 'Absent'
            Name                 = 'Web-Server'

        }
    }
    
    Node TeamCityAgent
    {
        WindowsFeature IIS
        {
            Ensure               = 'Absent'
            Name                 = 'Web-Server'

        }
        
        Service TeamCityBuildAgent
        {   
            DisplayName           = 'TeamCity Build Agent'
            Name                  = 'TeamCity Build Agent'
            StartupType           = 'Automatic'
            State                 = 'Running'
            Ensure                = 'Present'
            Credential            = $svcTeamCityAgent
            Path                  = 'F:\BuildAgent\bin\service.start.bat'
        }
    }
}
